# coding: utf-8 
# @æ—¶é—´   : 2021/8/14 4:35 ä¸‹åˆ
# @ä½œè€…   : æ–‡å±±
# @é‚®ç®±   : wolaizhinidexin@163.com
# @ä½œç”¨   : ç¥ç»ç½‘ç»œ
# @æ–‡ä»¶   : NeuralNetworks_1.py

"""
ç¥ç»ç½‘ç»œæ¨¡å‹å»ºç«‹åœ¨å¾ˆå¤šç¥ç»å…ƒä¹‹ä¸Šï¼Œæ¯ä¸€ä¸ªç¥ç»å…ƒåˆæ˜¯ä¸€ä¸ªä¸ªå­¦ä¹ æ¨¡å‹ã€‚
è¿™äº›ç¥ç»å…ƒ (ä¹Ÿå«æ¿€æ´»å•å…ƒï¼Œactivation unit)é‡‡çº³ä¸€äº›ç‰¹å¾ä½œä¸ºè¾“å‡ºï¼Œå¹¶ä¸”æ ¹æ®æœ¬èº«çš„æ¨¡å‹æä¾›ä¸€ä¸ªè¾“å‡ºã€‚

ã€”x_1ã€•     â—‹ã€”a_1^2ã€•
      â†—ï¸                 â†˜ï¸
ã€”x_2ã€•->   â—‹ã€”a_2^2ã€• âŸ¶ âŸ¶ â—‹ âŸ¶ âŸ¶ hğ·(X)
      â†˜ï¸                 â†—
ã€”x_3ã€•     â—‹ã€”a_3^2ã€•
 è¾“å…¥å±‚     éšè—å±‚        è¾“å‡ºå±‚
 ------------------------------------------------------------------
 Xè¾“å…¥å•å…ƒ, a_1ç§°ä¹‹ä¸ºéšè—å•å…ƒï¼Œæœ€åæ˜¯è¾“å‡ºå•å…ƒhğ·(X);ä¸Šå›¾ï¼Œæ¯ä¸ªXå‡ä¼šæœ‰3ä¸ªä¼ æ’­æ–¹å‘ã€‚
 åªè¦åœ¨è¾“å‡ºå±‚ä¹Ÿè¾“å‡ºå±‚ä¸­çš„éƒ½ç§°ä¹‹ä¸ºéšè—å±‚ã€‚æ¯ä¸€å±‚çš„è¾“å‡ºå˜é‡éƒ½æ˜¯ä¸‹ä¸€å±‚çš„è¾“å…¥å˜é‡ã€‚
 ------------------------------------------------------------------
 å› a_2å±‚ï¼Œå­˜åœ¨n3 * x3+1(åç½®é¡¹0)ä¸ªã€‚ a_3åˆ™æœ‰1 * n3+1 ï¼Œåˆ™æˆ‘ä»¬è·å–çš„ä¼ æ’­è·¯å¾„æœ‰ n * a + 1
 ------------------------------------------------------------------
 a_i^jä»£è¡¨ç¬¬jå±‚ç¬¬iä¸ªæ¿€æ´»å•å…ƒï¼›ğ·^jä»£è¡¨ä»ç¬¬jå±‚æ˜ å°„åˆ°j+1å±‚æ—¶çš„æƒé‡çš„çŸ©é˜µã€‚
 åˆ™,
 a_1^2 = g(ğ·_1_0^1 * x_0 + ğ·_1_1^1 * x_1 + ğ·_1_2^1 * x_2 + ğ·_1_3^1 * x_3 )
 a_2^2 = g(ğ·_2_0^1 * x_0 + ğ·_2_1^1 * x_1 + ğ·_2_2^1 * x_2 + ğ·_2_3^1 * x_3 )
 a_3^2 = g(ğ·_3_0^1 * x_0 + ğ·_3_1^1 * x_1 + ğ·_3_2^1 * x_2 + ğ·_3_3^1 * x_3 )

 è¾“å‡ºå±‚ï¼Œ
 hğ·(ğ‘¥) = g(ğ·_1_0^2 * a_0^2 + ğ·_1_1^2 * a_1^2 + ğ·_1_2^2 * a_2^2 + ğ·_1_3^2 * a_3^2)
 æ¯ä¸€ä¸ªğ‘éƒ½æ˜¯ç”±ä¸Šä¸€å±‚æ‰€æœ‰çš„ğ‘¥å’Œæ¯ä¸€ä¸ªğ‘¥æ‰€å¯¹åº”ğ·å†³å®šçš„,æˆ‘ä»¬å°†è¿™ä¸ªç®—æ³•ç§°ä¹‹ä¸ºå‰å‘ä¼ æ’­ç®—æ³•FORWARD PROPAGATIONã€‚
 ------------------------------------------------------------------
 å‘é‡åŒ–çš„è¡¨ç¤ºæ–¹æ³•ï¼Œåˆ™ä»¤ã€‚

     [ x_0           [  z_0^2
       x_1              z_1^2
 X =   x_2      Z^2 =   z_2^2
       x_3              z_3^2
     ]               ]


     [                                        [
       ğ·_1_0^1  ğ·_1_1^1  ğ·_1_2^1    ğ·_1_3^      x_0
 g *   ğ·_2_0^1  ğ·_2_1^1  ğ·_2_2^1    ğ·_2_3^1  *  x_1
       ğ·_3_0^1  ğ·_3_1^1  ğ·_3_2^1    ğ·_3_3^1     x_2
                                               x_3
    ]                                         ]
 åˆ™ä¸Šé¢çš„è®¡ç®—è¿‡ç¨‹å®è´¨ä¸ºï¼š
        [                                                                   [
            ğ·_1_0^1 * x_0 + ğ·_1_1^1 * x_1 + ğ·_1_2^1 * x_2 + ğ·_1_3^1 * x_3       a_1^2
 g *        ğ·_2_0^1 * x_0 + ğ·_2_1^1 * x_1 + ğ·_2_2^1 * x_2 + ğ·_2_3^1 * x_3  =    a_2^2
            ğ·_3_0^1 * x_0 + ğ·_3_1^1 * x_1 + ğ·_3_2^1 * x_2 + ğ·_3_3^1 * x_3       a_3^2
        ]                                                                   ]
 ä»¤, Z^2 = ğ·^1 * X, åˆ™a^2 = g(Z^2)ï¼Œè®¡ç®—åæ·»åŠ a_0^2 = 1ï¼Œåˆ™è®¡ç®—hğ·(ğ‘¥) çš„è¾“å‡ºä¸ºï¼š
                                                [
                                                  a_0^2
                                                  a_1^2
 g * [ğ·_1_0^2   ğ·_1_1^2  ğ·_1_2^2    ğ·_1_3^2] *     a_2^2
                                                  a_3^2
                                                ]
 åˆ™ä¸Šé¢çš„è®¡ç®—hğ·(ğ‘¥) è¿‡ç¨‹å®è´¨ä¸ºï¼š
 g * (ğ·_1_0^2 * a_0^2 + ğ·_1_1^2 * a_1^2 + ğ·_1_2^2 * a_2^2 + ğ·_1_3^2 * a_3^2) = hğ·(ğ‘¥)

 ä»¤Z^3 = ğ·^2 * a^2ï¼Œåˆ™hğ·(ğ‘¥) = a^3 = g(Z^3 )
 ------------------------------------------------------------------
 ç»¼ä¸Šï¼Œå…¶å®ç¥ç»ç½‘ç»œå°±åƒæ˜¯ logistic regressionï¼Œåªä¸è¿‡æˆ‘ä»¬æŠŠ logistic regression ä¸­çš„è¾“å…¥å‘é‡ [ğ‘¥_1 âˆ¼ ğ‘¥_3 ]
 å˜æˆäº†ä¸­é—´å±‚çš„[ğ‘_1^2 âˆ¼ ğ‘_3^2], å³:
 hğ·(ğ‘¥) = g * (ğ·_1_0^2 * a_0^2 + ğ·_1_1^2 * a_1^2 + ğ·_1_2^2 * a_2^2 + ğ·_1_3^2 * a_3^2)

 æˆ‘ä»¬å¯ä»¥æŠŠğ‘0, ğ‘1, ğ‘2, ğ‘3çœ‹æˆæ›´ä¸ºé«˜çº§çš„ç‰¹å¾å€¼ï¼Œä¹Ÿå°±æ˜¯ğ‘¥0, ğ‘¥1, ğ‘¥2, ğ‘¥3çš„è¿›åŒ–ä½“ï¼Œå¹¶ä¸”å®ƒä»¬æ˜¯ç”±ğ‘¥ä¸å†³å®šçš„ï¼Œ
 å› ä¸ºæ˜¯æ¢¯åº¦ä¸‹é™çš„(æ¯ä¸€å±‚çš„ğ·å€¼æ˜¯ç”±æ¢¯åº¦ä¸‹é™è·å–çš„ï¼‰ï¼Œæ‰€ä»¥ğ‘æ˜¯å˜åŒ–çš„ï¼Œå¹¶ä¸”å˜å¾—è¶Šæ¥è¶Šå‰å®³ï¼Œ
 æ‰€ä»¥è¿™äº›æ›´é«˜çº§çš„ç‰¹å¾å€¼è¿œæ¯”ä»…ä»…å°†ğ‘¥æ¬¡æ–¹å‰å®³ï¼Œä¹Ÿèƒ½æ›´å¥½çš„é¢„æµ‹æ–°æ•°æ®ã€‚

 ------------------------------------------------------------------
 é€»è¾‘ä¸(AND), x1,x2 åªèƒ½åœ¨(0,1)ä¸­é€‰æ‹©ï¼Œy = x1 and x2

ã€”1ã€•
         â†˜ï¸
ã€”x_2ã€• âŸ¶ âŸ¶ â—‹ âŸ¶ âŸ¶ hğ·(X)
         â†—
ã€”x_3ã€•

 å‡è®¾ğ·_1_0^1 = -30, ğ·_1_2^1 = 20, ğ·_1_3^1 = 20,åˆ™hğ·(X) = g ( -30 + 20 * x1 + 20 * x2)ï¼Œå› äºæ˜¯ä¸€ä¸ªäºŒåˆ†ç±»é—®é¢˜ï¼Œæ‰€ä»¥
 x1     x2    |  hğ·(X)
 0      0     |  g(-30) â‰ˆ 0
 0      1     |  g(-10) â‰ˆ 0
 1      0     |  g(-10) â‰ˆ 0
 1      1     |  g(10)  â‰ˆ 1

 å¦‚æœæ˜¯å¤šåˆ†ç±»é—®é¢˜ï¼Œæ¯”å¦‚4ä¸ªåˆ†ç±»ï¼Œåˆ™è¾“å‡ºçš„ç»“æœå¯èƒ½æ˜¯ä»¥ä¸‹ã€‚
 å¦‚æœ æˆ‘ä»¬è¦è®­ç»ƒä¸€ä¸ªç¥ç»ç½‘ç»œç®—æ³•æ¥è¯†åˆ«è·¯äººã€æ±½è½¦ã€æ‘©æ‰˜è½¦å’Œå¡è½¦ï¼Œåœ¨è¾“å‡ºå±‚æˆ‘ä»¬åº”è¯¥æœ‰4ä¸ªå€¼

        â—‹   â—‹
  â—‹     â—‹   â—‹   â—‹
  â—‹     â—‹   â—‹   â—‹
  â—‹     â—‹   â—‹   â—‹
                â—‹
        â—‹   â—‹

 [
   1 0 0 0
   0 1 0 0
   0 0 1 0
   0 0 0 1
 ]
"""
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
from scipy.io import loadmat


def sigmoid(z):
    return 1 / (1 + np.exp(-z))


def load_weight():
    """è·å¾—thetaå€¼"""
    data = loadmat('./data/ex3weights.mat')
    return data['Theta1'], data['Theta2']


def load_data():
    """åŸå§‹æ•°æ®"""
    data = loadmat('./data/ex3data1.mat')
    X = data['X']
    y = data['y']
    y = y.flatten()
    # å¢åŠ åç½®é¡¹
    X = np.insert(X, 0, values=np.ones(X.shape[0]), axis=1)  # intercept
    return X, y


def z2(X, theta1):
    """ Z^2 = ğ·^1 * X """
    a1 = X
    z2 = a1 @ theta1.T
    return z2


def z3(z2, theta2):
    z2 = np.insert(z2, 0, 1, axis=1)
    # a^2 = g(Z^2)
    a2 = sigmoid(z2)
    # Z^3 = ğ·^2 * a^2
    z3 = a2 @ theta2.T
    return z3


def a4(z3, y):
    """è¾“å‡ºå±‚ï¼Œå¾—åˆ°æœ€åçš„é¢„æµ‹å€¼"""
    # a^3 = g(Z^3)
    a3 = sigmoid(z3)
    y_pred = np.argmax(a3, axis=1) + 1
    accuracy = np.mean(y_pred == y)
    print('accuracy = {0}%'.format(accuracy * 100))  # accuracy = 97.52%


if __name__ == "__main__":
    """å‰å‘ä¼ æ’­çš„æ¼”ç¤ºã€‚theta1,theta2çš„å€¼å·²è·å–åˆ°ex3weights.matæ–‡ä»¶ä¸­"""
    theata = load_weight()
    # Xå€¼ï¼Œç¬¬1å±‚çš„å€¼
    X, y = load_data()
    # éšè—å±‚ä¸­ç¬¬2å±‚çš„è®¡ç®—
    z2 = z2(X, theata[0])
    # éšè—å±‚ä¸­ç¬¬3å±‚çš„è®¡ç®—
    z3 = z3(z2, theata[1])
    # è¾“å‡ºå±‚çš„ç»“æœ
    a4(z3, y)
